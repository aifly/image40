<html>
    <head>
        <meta charset='utf-8'/>
        <meta name='viewport' content='width=750,user-scalable=no'/>
        
        <script>
            !function(url){
                var link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = url+'?t='+new Date().getTime();
                document.head.appendChild(link);
            }('./assets/css/index.css');
        </script>
        <title>
           四十年 四十家
        </title>
        <style>
            *{margin:0;padding:0}
            a{
                text-decoration:none;
            }
        </style>
    </head>
    <body>
        <div id='loading'>
                <a href="#">
                <section class='zmiti-head' style="background:url(./assets/images/logo.png) no-repeat center / cover"></section>
                <div class="line1"></div>
                <div class="line2"></div>
                <div class="line3"></div>
                <div id='progress' class='zmiti-progress'></div>
            </a>
        </div>
        <div class='zmiti-main-ui'>

        </div>

        <script src="//res.wx.qq.com/open/js/jweixin-1.3.0.js"></script>

	<script>
		window.h5name  =  'image40';
        document.getElementsByTagName('html')[0].style.fontSize = 750 / 10 + 'px';
		function wxHandlercallback(res,title,desc) {
			arguments.callee.res = arguments.callee.res || res;
			wx.config({
				debug: false,
				appId: arguments.callee.res.appId,
				timestamp: arguments.callee.res.timestamp,
				nonceStr: arguments.callee.res.nonceStr,
				signature: arguments.callee.res.signature,
				jsApiList: ["onMenuShareTimeline", "onMenuShareAppMessage", "onMenuShareQQ", "onMenuShareQZone",
					"onMenuShareWeibo"
				]
			});

			//window.location.href = encodeURI(window.location.href)

			wx.ready(function () {
				var config = {
					title: '四十年，四十家',
					desc: '40年华，“画”说我家',
					//link: encodeURIComponent(window.location.href.split('?')[0].split('#')[0]),
					link: 'https://h5.zhongguowangshi.com/h5/'+window.h5name+'/index.html',
					imgUrl: "http://h5.zhongguowangshi.com/h5/"+window.h5name+"/assets/images/300-1.jpg",
					error:function(){

					},
					success(){
					}
				};
				wx.onMenuShareAppMessage(config);
				wx.onMenuShareTimeline(config);
			});
		}
	</script>

        <script src="//openapi.zhongguowangshi.com/wxHandler.ashx?callback=wxHandlercallback&action=getWeixinConfig&debug=1&site=xhsh5"></script>
    <script>
        !function(){


            function Face(option){
                var option = option || {};
                this.x = option.x;
                this.y = option.y;
                this.vx = Math.random()*-100;
                this.vy = Math.random()*-100;
            };

            Face.prototype = {
                constructor:Face
            };


            

            var util = {
                loading: function(arr, fn, fnEnd) {
                    var len = arr.length;
                    var count = 0;
                    var i = 0;

                    function loadimg() {
                        if (i === len) {
                            return;
                        }
                        var img = new Image();
                        img.onload = img.onerror = function() {
                            count++;
                            if (i < len - 1) {
                                i++;
                                loadimg();
                                fn && fn(i / (len - 1), img.src);
                            } else {
                                fnEnd && fnEnd(img.src);
                            }
                        };
                        img.src = arr[i];
                    }
                    loadimg();
                },
                bindEvent(){
                    
                    this.$('#loading').ontouchstart = function(e){
                        e.preventDefault();
                    }
                    
                },
                $:function(selector){
                    return document.querySelector(selector);
                },
                imgList:[
                    {
                        title:'从窑洞搬进楼房【山西分社 曹阳】',
                        imgs:[
                            './assets/images/2-1.jpg',
                            './assets/images/1-1.jpg',
                        ],
                        desc:'1997年2月10日，山西省太原市小店区郑村村民薛美香在自家的窑洞里留影。（左图）2018年11月20日，今年90岁的山西省太原市小店区郑村村民薛美香在居住的楼房里留影。（右图）新华社记者 曹阳 摄 13593186930'
                    },
                     {
                        title:'在阅读中穿越时光【甘肃分社 陈斌】',
                        imgs:[
                            './assets/images/4-1.jpg',
                            './assets/images/3-1.jpg',
                        ],
                        desc:'甘肃省兰州市西固区市民黄巧香坐在家中沙发上看杂志。（左图：1980年2月17日摄）甘肃省兰州市西固区市民黄巧香坐在家中沙发上看报纸。（右图：11月13日摄）新华社记者 陈斌 摄'
                    },
                    {
                        title:'电视机的升级换代【甘肃分社 陈斌】',
                        imgs:[
                            './assets/images/6-1.jpg',
                            './assets/images/5-1.jpg',
                        ],
                        desc:'左图：甘肃省兰州市西固区市民陈玉芳在家里的电视机前拍照。（1990年9月20日摄）右图：甘肃省兰州市西固区市民陈玉芳在家里的电视机前拍照。（11月13日摄）新华社记者 陈斌 摄'
                    },
                    {
                        title:'自行车变小汽车【河南分社 冯大鹏】',
                        imgs:[
                            './assets/images/8-1.jpg',
                            './assets/images/7-1.jpg',
                        ],
                        desc:'左，2002年10月6日，河南省兰考县桐乡街道盆窑村，村民李傲星在老房子前骑在自行车上留影（翻拍照片，2018年11月14日摄）；右，在河南省兰考县桐乡街道盆窑村，村民李傲星在新房子前站在奔驰车旁留影（2018年11月14日摄）。新华社记者冯大鹏摄 18530926836'
                    },
                    {
                        title:'看我的新家！【河南分社 冯大鹏】',
                        imgs:[
                            './assets/images/10-1.jpg',
                            './assets/images/9-1.jpg',
                        ],
                        desc:'拼版图片：左，2002年10月6日，河南省兰考县桐乡街道盆窑村，村民李傲星在老房子前打拳（翻拍照片，2018年11月14日摄）；右，在河南省兰考县桐乡街道盆窑村，村民李傲星在新房子前打拳（2018年11月14日摄）。新华社记者冯大鹏摄 18530926836'
                    },
                    {
                        title:'妈妈与我【河南分社 冯大鹏】',
                        imgs:[
                            './assets/images/12-1.jpg',
                            './assets/images/11-1.jpg',
                        ],
                        desc:'拼版图片：左，2002年10月6日，河南省兰考县桐乡街道盆窑村，村民李傲星（右）在老房子前和母亲陈美玲合影（翻拍照片，2018年11月14日摄）；右，在河南省兰考县桐乡街道盆窑村，村民李傲星（右）在新房子前和母亲陈美玲合影（2018年11月14日摄）。新华社记者冯大鹏摄 18530926836'
                    },{
                        title:'脱贫奔小康，住进小洋楼【河南分社 冯大鹏】',
                        imgs:[
                            './assets/images/14-1.jpg',
                            './assets/images/13-1.jpg',
                        ],
                        desc:'拼版照片：左图，在河南省兰考县堌阳镇徐场村，村民徐会平（右）和妻子柳建丽2002年在老旧的瓦房下合影（翻拍照片，2018年11月9日摄）；右图，在河南省兰考县堌阳镇徐场村，村民徐会平（右）和妻子柳建丽在建设中的小洋楼前合影（2018年11月9日摄），随着兰考县产业扶贫的推进，徐会平和妻子依靠琵琶制作技艺摆脱了贫困并奔上了小康路。新华社记者冯大鹏摄 18530926836'
                    },{
                        title:'老式家具升级啦！【黑龙江分社 王建威 王凯】',
                        imgs:[
                            './assets/images/16-1.jpg',
                            './assets/images/15-1.jpg',
                        ],
                        desc:'拼版照片：左图为牡丹江市民于林波8岁时在自家老式立柜前画画留影（于林波提供1978年拍摄照片）；右图为牡丹江市民于林波48岁时在牡丹江家中电脑桌边留影（2018年11月13日，新华社记者王建威摄）。'
                    },{
                        title:'大兴安岭的姐弟俩【黑龙江分社 王建威 王凯】',
                        imgs:[
                            './assets/images/18-1.jpg',
                            './assets/images/17-1.jpg',
                        ],
                        desc:'左图，1982年，在我国最北的大兴安岭地区首府加格达奇地区，崔健（右）和姐姐崔波在家中合影。（新华社发）右图，2018年8月29日，在我国最北的大兴安岭地区首府加格达奇地区，崔健（右）和姐姐崔波在家中合影，他们已经使用智能手机用来通讯、电子支付以及处理工作和生活的很多事情。（新华社记者王凯摄）'
                    },{
                        title:'家里的”火墙”换新颜【黑龙江分社 王建威 王凯】',
                        imgs:[
                            './assets/images/20-1.jpg',
                            './assets/images/19-1.jpg',
                        ],
                        desc:'左图，1981年，在我国最北的大兴安岭地区首府加格达奇地区，周宁在自家平房内看书，她的身后是老东北传统平房的火墙。（新华社发）右图，2018年8月28日，在我国最北的大兴安岭地区首府加格达奇地区，周宁在自家屋内看书。（新华社记者王凯摄）'
                    },{
                        title:'吴家有女初长成【黑龙江分社 王建威 王凯】',
                        imgs:[
                            './assets/images/22-1.jpg',
                            './assets/images/21-1.jpg',
                        ],
                        desc:'左图，1993年1月，哈尔滨市民吴濯蓥在家里拍照。（新华社发）右图，2018年8月6日，哈尔滨市民吴濯蓥在家里当年的位置拍照。（新华社记者王凯摄）'
                    },{
                        title:'小女孩长成了大姑娘【安徽分社 刘军喜 张端】',
                        imgs:[
                            './assets/images/24-1.jpg',
                            './assets/images/23-1.jpg',
                        ],
                        desc:'左图，11994年，6岁的周爱际在位于安徽省合肥市包河区金寨南路社区的家里玩耍。（新华社记者刘军喜翻拍）右图，2018年11月11日，30岁的周爱际在位于安徽省合肥市包河区金寨南路社区的家里。（新华社记者刘军喜摄）'
                    },{
                        title:'我们这一家子【安徽分社 刘军喜 张端】',
                        imgs:[
                            './assets/images/26-1.jpg',
                            './assets/images/25-1.jpg',
                        ],
                        desc:'左图，1992年，卫世平（后右）、妻子陆广梅（后左）、大女儿陆海燕（前右）、二女儿陆海娣（前左）、儿子卫林（前中）合影留念。右图，2018年11月14日，卫世平（前右）、妻子陆广梅（前左）、大女儿陆海燕（后右）、二女儿陆海娣（后左）、儿子卫林（中）在合肥市滨湖欣园社区的家中合影。新华社记者 张端 摄'
                    },{
                        title:'从小学习做家务【广东分社 唐寿新】',
                        imgs:[
                            './assets/images/28-1.jpg',
                            './assets/images/27-1.jpg',
                        ],
                        desc:'左图为1999年8月6日，9岁的唐诗言在东莞市长安镇家里洗碗（唐寿新摄），右图为2018年11月1日，28岁的唐诗言在东莞市长安镇家里洗碗。'
                    },{
                        title:'琴声悠悠岁月长【广东分社 唐寿新】',
                        imgs:[
                            './assets/images/30-1.jpg',
                            './assets/images/29-1.jpg',
                        ],
                        desc:'左图为1994年7月12日，4岁的唐诗言在东莞市长安镇家里练习电子琴（唐寿新摄），右图为2018年11月1日，28岁的唐诗言在东莞市长安镇家里练习钢琴。'
                    },{
                        title:'妈妈陪你长大！【江西分社 彭昭之】',
                        imgs:[
                            './assets/images/32-1.jpg',
                            './assets/images/31-1.jpg',
                        ],
                        desc:'左图，摄于1989年 当时33岁的周月娇和7岁的儿子徐涛在江西省南昌市青云谱区京山老街的老房子里合影，当时周月娇是一名普通的社区干部。（彭昭之）右图，今年62岁的周月娇和36岁的儿子徐涛正在南昌市青云谱区三家店街道祥和社区的家中合影，如今的儿子徐涛也有了自己的两个孩子。（彭昭之）'
                    },{
                        title:'姐妹情深【江西分社 彭昭之】',
                        imgs:[
                            './assets/images/34-1.jpg',
                            './assets/images/33-1.jpg',
                        ],
                        desc:'左图，摄于1991年 当时4岁的卢婧（右）和2岁的表妹李良智正在家中一起玩耍吃东西，当时他们家位于江西省南昌市青云谱区井冈山大道东后巷。（彭昭之）右图，今年31岁的卢婧（右）和29岁的表妹李良智正在位于江西省南昌市青云谱三家店街道的家中一边聊天一边吃零食。（彭昭之）'
                    },{
                        title:'纸质书变电子书【江西分社 万象】',
                        imgs:[
                            './assets/images/36-1.jpg',
                            './assets/images/35-1.jpg',
                        ],
                        desc:'左图，江西南昌市民彭菁在家中看书（1993年摄）（翻拍照片）。右图，江西南昌市民彭菁（左）抱着儿子在家中的沙发上看电子书（2018年11月14日摄）。新华社记者 万象 摄'
                    },{
                        title:'在洪湖里长大，在洪湖外安家【湖北分社 熊琦】',
                        imgs:[
                            './assets/images/38-1.jpg',
                            './assets/images/37-1.jpg',
                        ],
                        desc:'左图，拆网上岸前，王贵宝一家在洪湖上的住所。（资料照片）右图，王贵宝（右一）与父母在新家里。（新华社记者 熊琦 摄）'
                    },{
                        title:'外婆、妈妈和我【山西分社 詹彦】',
                        imgs:[
                            './assets/images/40-1.jpg',
                            './assets/images/39-1.jpg',
                        ],
                        desc:'左图，1990年10月，在山西省太原市古交市（县级市），5岁的张斯和妈妈要平智在家中合影（翻拍照片，2018年11月13日摄）。右图，11月13日，在山西省太原市小店区，33岁的张斯和5岁的女儿韩斯旸在家中合影。新华社记者 詹彦 摄 '
                    },{
                        title:'从茅草房搬进小楼房【广西分社 张爱林】',
                        imgs:[
                            './assets/images/42-1.jpg',
                            './assets/images/41-1.jpg',
                        ],
                        desc:'左图，那坡县边境零公里线上甲柳村上保屯苗族青年吴亚路家的茅草房（2009年7月14日摄）。右图，那坡县边境零公里线上甲柳村上保屯苗族青年吴亚路家房屋（2018年3月15日摄）新华社记者张爱林摄'
                    },{
                        title:'一条路的变迁【广西分社 张爱林】',
                        imgs:[
                            './assets/images/44-1.jpg',
                            './assets/images/43-1.jpg',
                        ],
                        desc:'左图，那坡县边境零公里线上甲柳村上保屯十年前的进屯路（2009年7月14日摄）。右图，那坡县边境零公里线上甲柳村上保屯现在的进村路（2018年6月7日摄）新华社记者张爱林摄'
                    },{
                        title:'姐弟俩【广西分社 张爱林】',
                        imgs:[
                            './assets/images/46-1.jpg',
                            './assets/images/45-1.jpg',
                        ],
                        desc:'左图，那坡县边境零公里线上那布村水弄一社儿时的陶美星跟随姐姐上山拾取柴火的照片（2009年4月5日摄）。右图，那坡县边境零公里线上那布村水弄一社陶美星和姐姐共度周末的照片（2018年3月17日摄）新华社记者张爱林摄'
                    },{
                        title:'苗族婚宴的变迁【广西分社 张爱林】',
                        imgs:[
                            './assets/images/48-1.jpg',
                            './assets/images/47-1.jpg',
                        ],
                        desc:'左图，十几年前那坡县边境零公里线上那布村水弄一社一户苗族青年结婚宴（2008年11月5日摄）。右图，那坡县边境零公里线上甲柳村上保屯苗族青年吴文荣的婚宴（2018年3月6日摄）新华社记者张爱林摄'
                    }
                ],
                $$:function(selector){
                    return document.querySelectorAll(selector);
                },
                layout:function(){
                    var html = ''
                    this.imgList.forEach(function(img,i){
                        if(img.title){
                            html+="<div class='zmiti-swpier-item'>\
                                        <h3 class='zmiti-header'>"+(i+1)+"、"+img.title+"</h3>\
                                        <div class='zmiti-img-box'>\
                                            <img draggable='false' src='"+img.imgs[0]+"' class='zmiti-img' />\
                                            <img draggable='false' src='"+img.imgs[1]+"' class='zmiti-img' />\
                                            <canvas></canvas>\
                                            <div class='zmiti-swipe-bar'></div>\
                                        </div>\
                                        <div class='zmiti-swiper-bottom'>\
                                            "+img.desc+"\
                                        </div>\
                                        <div class='zmiti-like'>\
                                            <img draggable='false' src='./assets/images/like.png'/>\
                                            <div class='zmiti-face'><img draggable='false' src='./assets/images/like.png'/>\</div>\
                                            <div class='zmiti-face'><img draggable='false' src='./assets/images/like.png'/>\</div>\
                                            <div class='zmiti-face'><img draggable='false' src='./assets/images/like.png'/>\</div>\
                                            <div class='zmiti-face'><img draggable='false' src='./assets/images/like.png'/>\</div>\
                                            <div class='zmiti-face'><img draggable='false' src='./assets/images/like.png'/>\</div>\
                                            <div class='zmiti-face'><img draggable='false' src='./assets/images/like.png'/>\</div>\
                                            <div class='zmiti-face'><img draggable='false' src='./assets/images/like.png'/>\</div>\
                                            <div class='zmiti-face'><img draggable='false' src='./assets/images/like.png'/>\</div>\
                                            <div class='zmiti-face'><img draggable='false' src='./assets/images/like.png'/>\</div>\
                                            <div class='zmiti-face'><img draggable='false' src='./assets/images/like.png'/>\</div>\
                                            <div class='zmiti-face'><img draggable='false' src='./assets/images/like.png'/>\</div>\
                                        </div>\
                                    </div>"
                        }
                    })

                    this.$('.zmiti-main-ui').innerHTML = html;
                    var like = this.$('.zmiti-like');
                    var faces = like.querySelectorAll('.zmiti-face');
                    like.ontouchend = function(){
                        faces.forEach(function(face,i){
                            
                        });
                    };
                },
                init:function(){
                    this.bindEvent();
                    var imgList = [];
                    this.imgList.forEach(function(img){
                        imgList = imgList.concat(img.imgs)
                    });

                    var s = this;
                    var pro = s.$('#progress');
                    this.loading(imgList,function(e){
                        pro.innerHTML = (e*100|0)+"%";
                    },function(){
                       s.$('#loading').style.display = 'none';
                       s.layout();
                       s.setSize();
                    })
                },
                initCanvas:function(){
                    this.canvases.forEach(function(item,i){
                    var {canvas,imgs,box,offsetLeft} = item;
                    var canvas = item.canvas,
                        box = item.box,
                        offsetLeft = item.offsetLeft;
                        var context = canvas.getContext('2d');
                        var img = new Image();
                        var s = 0.1;
                        img.onload = function(){
                            var scale = this.width / canvas.width;
                            context.drawImage(imgs[0],0,0,canvas.width,canvas.height);
                            setTimeout(function(){
                                context.drawImage(imgs[1],0,0,canvas.width*scale*s,canvas.height*scale,0,0,canvas.width*s,canvas.height);
                            },100)
                            var bar = box.querySelector('.zmiti-swipe-bar');

                            function start(e){
                                
                                //e.preventDefault();
                                document.ontouchmove = function(e){
                                    e.preventDefault();
                                    var pageX = e.changedTouches[0].pageX;
                                    s = (pageX - offsetLeft) / canvas.width;
                                    context.clearRect(0,0,canvas.width,canvas.height);
                                    context.drawImage(imgs[0],0,0,canvas.width,canvas.height);
                                    
                                    context.drawImage(imgs[1],0,0,canvas.width*scale*s,canvas.height*scale,0,0,canvas.width*s,canvas.height);
                                    bar.style.left = Math.min(Math.max(s*100,0),99)+'%';
                                    return false;
                                }
                                document.ontouchend = function(e){
                                    e.preventDefault();
                                    document.ontouchmove = null;
                                    document.ontouchend = null;
                                    var ss = s;
                                    setTimeout(function(){
                                        var t = setInterval(function(){
                                            if(s>.5){
                                                s-=.04;
                                            }
                                            else{
                                                s+=.04;                                           
                                            }
                                             if(Math.abs(s -.5)<=.08){
                                                s = .5;
                                                clearInterval(t);
                                            }

                                            context.clearRect(0,0,canvas.width,canvas.height);
                                            context.drawImage(imgs[0],0,0,canvas.width,canvas.height);
                                            
                                            context.drawImage(imgs[1],0,0,canvas.width*scale*s,canvas.height*scale,0,0,canvas.width*s,canvas.height);
                                            bar.style.left = Math.min(Math.max(s*100,0),99)+'%';


                                        },20);
                                    },100)

 
                                }
                            }
                            canvas.ontouchstart = function(e){
                                
                                start(e);
                                //return false;
                            }
                            box.ontouchstart = function(e){
                                start(e);
                               // return false;
                            }
                        }
                        img.src = imgs[0].src;
                     });
                },
               
                setSize:function(){
                    var $$ = this.$$;
                    this.canvases = [];
                    var self = this;
                    setTimeout(function(){
                        for(var i = 0;i<$$('.zmiti-img-box').length;i++){
                            var box = $$('.zmiti-img-box')[i];
                            var offsetLeft = box.offsetLeft;
                            var imgs = box.querySelectorAll('.zmiti-img');
                            var canvas = box.querySelector('canvas');
                                canvas.height = box.clientHeight;
                                canvas.width = box.clientWidth;
                                self.canvases.push({canvas,imgs,box,offsetLeft});
                                self.initCanvas();
                        };
                    },100)
                },
            };

            util.init();

        }();
    </script>
    </body>
</html>